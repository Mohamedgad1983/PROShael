<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Test - Member Monitoring Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .qa-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h2 {
            color: #444;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .test-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .test-btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .test-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .test-btn.info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .result-box {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .result-box.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result-box.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result-box.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .result-box.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .test-list {
            list-style: none;
            padding: 0;
        }

        .test-list li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-list li::before {
            content: 'â³';
            font-size: 20px;
        }

        .test-list li.pass::before {
            content: 'âœ…';
        }

        .test-list li.fail::before {
            content: 'âŒ';
        }

        .pagination-test {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .page-test-btn {
            padding: 8px 12px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .page-test-btn:hover {
            background: #667eea;
            color: white;
        }

        .page-test-btn.current {
            background: #667eea;
            color: white;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading::after {
            content: '.';
            animation: dots 1s steps(3, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="qa-container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø©</h1>
        <p class="subtitle">Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ - Member Monitoring Dashboard</p>

        <!-- Test Section 1: API Connection -->
        <div class="test-section">
            <h2>1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
            <div class="test-controls">
                <button class="test-btn" onclick="testAPIConnection()">Ø§Ø®ØªØ¨Ø§Ø± API</button>
                <button class="test-btn info" onclick="checkTotalMembers()">ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
                <button class="test-btn success" onclick="testAuthentication()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
            </div>
            <div id="apiResult"></div>
            <div class="stats-grid" id="apiStats" style="display: none;">
                <div class="stat-card">
                    <div class="value" id="totalMembers">0</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="apiResponseTime">0ms</div>
                    <div class="label">Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="apiStatus">-</div>
                    <div class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</div>
                </div>
            </div>
        </div>

        <!-- Test Section 2: Pagination -->
        <div class="test-section">
            <h2>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª (Pagination)</h2>
            <div class="test-controls">
                <button class="test-btn" onclick="testPagination()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª</button>
                <button class="test-btn info" onclick="testPageSizes()">Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª</button>
                <button class="test-btn success" onclick="testAllPages()">ØªØµÙØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª</button>
            </div>
            <div id="paginationResult"></div>
            <div class="pagination-test" id="pageButtons" style="display: none;"></div>
        </div>

        <!-- Test Section 3: Member Data -->
        <div class="test-section">
            <h2>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
            <div class="test-controls">
                <button class="test-btn" onclick="testMemberData()">ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button class="test-btn info" onclick="testSearchFilter()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø«</button>
                <button class="test-btn success" onclick="testBalanceCalculations()">ÙØ­Øµ Ø§Ù„Ø£Ø±ØµØ¯Ø©</button>
            </div>
            <div id="memberDataResult"></div>
        </div>

        <!-- Test Section 4: Performance -->
        <div class="test-section">
            <h2>4ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
            <div class="test-controls">
                <button class="test-btn" onclick="testPerformance()">Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
                <button class="test-btn info" onclick="testLargeDataSet()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</button>
                <button class="test-btn danger" onclick="testStressLoad()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ·</button>
            </div>
            <div id="performanceResult"></div>
        </div>

        <!-- Test Section 5: Complete QA Suite -->
        <div class="test-section">
            <h2>5ï¸âƒ£ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
            <div class="test-controls">
                <button class="test-btn success" onclick="runCompleteQASuite()" style="width: 100%;">
                    ğŸš€ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                </button>
            </div>
            <ul class="test-list" id="qaTestList"></ul>
            <div id="qaSummary"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3001';
        const token = localStorage.getItem('token') || '';

        // Helper function to show results
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result-box ${type}`;
            element.innerHTML = typeof message === 'object'
                ? `<pre>${JSON.stringify(message, null, 2)}</pre>`
                : message;
            element.style.display = 'block';
        }

        // Test API Connection
        async function testAPIConnection() {
            showResult('apiResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');
            const startTime = Date.now();

            try {
                const response = await fetch(`${API_BASE_URL}/api/members?limit=1&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('apiStats').style.display = 'grid';
                    document.getElementById('apiResponseTime').textContent = `${responseTime}ms`;
                    document.getElementById('apiStatus').textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';

                    showResult('apiResult', `âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­! Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­`, 'success');
                } else {
                    showResult('apiResult', `âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${data.error || response.statusText}`, 'error');
                }
            } catch (error) {
                showResult('apiResult', `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        // Check Total Members
        async function checkTotalMembers() {
            showResult('apiResult', 'Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/members?limit=1&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok && data.pagination) {
                    const total = data.pagination.total;
                    document.getElementById('apiStats').style.display = 'grid';
                    document.getElementById('totalMembers').textContent = total;

                    // Now fetch all members
                    const allMembersResponse = await fetch(`${API_BASE_URL}/api/members?limit=${total}&page=1`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const allData = await allMembersResponse.json();
                    const actualCount = allData.data ? allData.data.length : 0;

                    const resultMessage = `
                        <strong>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ ÙØ­Øµ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡:</strong><br>
                        â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${total}<br>
                        â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ÙØ³ØªÙ„Ù…Ø©: ${actualCount}<br>
                        â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${actualCount === total ? 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…ØªØ§Ø­Ø©' : 'âš ï¸ Ù‡Ù†Ø§Ùƒ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø§Ù„Ø¹Ø¯Ø¯'}<br>
                        ${total === 347 ? 'âœ… Ø§Ù„Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ (347 Ø¹Ø¶Ùˆ)' : `âš ï¸ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ 347 ÙˆÙ„ÙƒÙ† ÙˆØ¬Ø¯Ù†Ø§ ${total}`}
                    `;

                    showResult('apiResult', resultMessage, actualCount === total ? 'success' : 'warning');
                } else {
                    showResult('apiResult', 'âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡', 'error');
                }
            } catch (error) {
                showResult('apiResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Test Authentication
        async function testAuthentication() {
            if (!token) {
                showResult('apiResult', 'âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ù…ØµØ§Ø¯Ù‚Ø©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }

            showResult('apiResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/verify`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    showResult('apiResult', `âœ… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ØµØ­ÙŠØ­Ø©! Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${data.user?.email || data.user?.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`, 'success');
                } else {
                    showResult('apiResult', `âŒ ÙØ´Ù„Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${data.error || 'Ø±Ù…Ø² ØºÙŠØ± ØµØ§Ù„Ø­'}`, 'error');
                }
            } catch (error) {
                showResult('apiResult', `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${error.message}`, 'error');
            }
        }

        // Test Pagination
        async function testPagination() {
            showResult('paginationResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª...', 'info');

            try {
                // Test different page sizes
                const pageSizes = [10, 25, 50, 100];
                const results = [];

                for (const size of pageSizes) {
                    const response = await fetch(`${API_BASE_URL}/api/members?limit=${size}&page=1`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (response.ok) {
                        results.push({
                            pageSize: size,
                            returned: data.data?.length || 0,
                            totalPages: data.pagination?.pages || 0
                        });
                    }
                }

                let resultHTML = '<strong>ğŸ“„ Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª:</strong><br>';
                results.forEach(r => {
                    const status = r.returned === r.pageSize || r.returned > 0 ? 'âœ…' : 'âŒ';
                    resultHTML += `${status} Ø­Ø¬Ù… Ø§Ù„ØµÙØ­Ø© ${r.pageSize}: Ø§Ø³ØªÙ„Ù…Ù†Ø§ ${r.returned} Ø¹Ø¶Ùˆ (${r.totalPages} ØµÙØ­Ø§Øª)<br>`;
                });

                showResult('paginationResult', resultHTML, 'success');

                // Show page buttons for testing
                const totalPages = results[0]?.totalPages || 1;
                const pageButtonsDiv = document.getElementById('pageButtons');
                pageButtonsDiv.innerHTML = '';
                pageButtonsDiv.style.display = 'flex';

                for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                    const btn = document.createElement('button');
                    btn.className = 'page-test-btn';
                    btn.textContent = `ØµÙØ­Ø© ${i}`;
                    btn.onclick = () => testSpecificPage(i);
                    pageButtonsDiv.appendChild(btn);
                }
            } catch (error) {
                showResult('paginationResult', `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª: ${error.message}`, 'error');
            }
        }

        // Test specific page
        async function testSpecificPage(pageNumber) {
            showResult('paginationResult', `Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø© ${pageNumber}...`, 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/members?limit=25&page=${pageNumber}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    const message = `
                        âœ… Ø§Ù„ØµÙØ­Ø© ${pageNumber} ØªØ¹Ù…Ù„!<br>
                        â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${data.data?.length || 0}<br>
                        â€¢ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${data.pagination?.page}<br>
                        â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙØ­Ø§Øª: ${data.pagination?.pages}
                    `;
                    showResult('paginationResult', message, 'success');
                } else {
                    showResult('paginationResult', `âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ${pageNumber}`, 'error');
                }
            } catch (error) {
                showResult('paginationResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Test all page sizes
        async function testPageSizes() {
            showResult('paginationResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª...', 'info');

            const sizes = [10, 25, 50, 100, 347];
            let allPassed = true;
            let results = '<strong>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª:</strong><br>';

            for (const size of sizes) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/members?limit=${size}&page=1`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    const returned = data.data?.length || 0;
                    const passed = response.ok && returned > 0;
                    allPassed = allPassed && passed;

                    results += `${passed ? 'âœ…' : 'âŒ'} Ø­Ø¬Ù… ${size}: ${returned} Ø¹Ø¶Ùˆ<br>`;
                } catch (error) {
                    results += `âŒ Ø­Ø¬Ù… ${size}: Ø®Ø·Ø£ - ${error.message}<br>`;
                    allPassed = false;
                }
            }

            showResult('paginationResult', results, allPassed ? 'success' : 'warning');
        }

        // Test navigating through all pages
        async function testAllPages() {
            showResult('paginationResult', 'Ø¬Ø§Ø±ÙŠ ØªØµÙØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª...', 'info');

            try {
                // First get total pages
                const initialResponse = await fetch(`${API_BASE_URL}/api/members?limit=50&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const initialData = await initialResponse.json();
                const totalPages = initialData.pagination?.pages || 1;
                const totalMembers = initialData.pagination?.total || 0;

                let totalFetched = 0;
                let results = `<strong>ğŸ“š ØªØµÙØ­ ${totalPages} ØµÙØ­Ø© (${totalMembers} Ø¹Ø¶Ùˆ):</strong><br>`;

                for (let page = 1; page <= totalPages; page++) {
                    const response = await fetch(`${API_BASE_URL}/api/members?limit=50&page=${page}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    const count = data.data?.length || 0;
                    totalFetched += count;

                    results += `â€¢ ØµÙØ­Ø© ${page}: ${count} Ø¹Ø¶Ùˆ âœ…<br>`;
                }

                results += `<br><strong>Ø§Ù„Ù…Ù„Ø®Øµ:</strong><br>`;
                results += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${totalMembers}<br>`;
                results += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙØ³ØªÙ„Ù…: ${totalFetched}<br>`;
                results += totalFetched === totalMembers
                    ? 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…ØªØ§Ø­Ø© Ø¹Ø¨Ø± Ø§Ù„ØµÙØ­Ø§Øª!'
                    : `âš ï¸ Ù‡Ù†Ø§Ùƒ ÙØ±Ù‚: ${totalMembers - totalFetched} Ø¹Ø¶Ùˆ`;

                showResult('paginationResult', results, totalFetched === totalMembers ? 'success' : 'warning');
            } catch (error) {
                showResult('paginationResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Test member data integrity
        async function testMemberData() {
            showResult('memberDataResult', 'Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/members?limit=100&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                const members = data.data || [];

                // Check data integrity
                let missingPhone = 0;
                let missingName = 0;
                let missingMembershipNumber = 0;
                let invalidBalance = 0;

                members.forEach(member => {
                    if (!member.phone) missingPhone++;
                    if (!member.full_name) missingName++;
                    if (!member.membership_number) missingMembershipNumber++;
                    if (member.current_balance === undefined || member.current_balance === null) invalidBalance++;
                });

                const results = `
                    <strong>ğŸ” ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (${members.length} Ø¹Ø¶Ùˆ):</strong><br>
                    ${missingPhone === 0 ? 'âœ…' : 'âš ï¸'} Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: ${missingPhone}<br>
                    ${missingName === 0 ? 'âœ…' : 'âš ï¸'} Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: ${missingName}<br>
                    ${missingMembershipNumber === 0 ? 'âœ…' : 'âš ï¸'} Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: ${missingMembershipNumber}<br>
                    ${invalidBalance === 0 ? 'âœ…' : 'âš ï¸'} Ø§Ù„Ø£Ø±ØµØ¯Ø© ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø©: ${invalidBalance}<br>
                    <br>
                    <strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©:</strong> ${
                        (missingPhone + missingName + missingMembershipNumber + invalidBalance) === 0
                        ? 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ù„ÙŠÙ…Ø©!'
                        : 'âš ï¸ ÙŠÙˆØ¬Ø¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©'
                    }
                `;

                showResult('memberDataResult', results,
                    (missingPhone + missingName + missingMembershipNumber + invalidBalance) === 0 ? 'success' : 'warning');
            } catch (error) {
                showResult('memberDataResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Test search functionality
        async function testSearchFilter() {
            showResult('memberDataResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©...', 'info');

            const searchTests = [
                { query: 'Ø£Ø­Ù…Ø¯', field: 'name' },
                { query: '050', field: 'phone' },
                { query: 'SH', field: 'membership' }
            ];

            let results = '<strong>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø«:</strong><br>';

            for (const test of searchTests) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/members?search=${test.query}&limit=10&page=1`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    const count = data.data?.length || 0;

                    results += `${count > 0 ? 'âœ…' : 'âš ï¸'} Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${test.query}": ${count} Ù†ØªÙŠØ¬Ø©<br>`;
                } catch (error) {
                    results += `âŒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${test.query}": Ø®Ø·Ø£<br>`;
                }
            }

            showResult('memberDataResult', results, 'info');
        }

        // Test balance calculations
        async function testBalanceCalculations() {
            showResult('memberDataResult', 'Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø±ØµØ¯Ø©...', 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/api/members?limit=50&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                const members = data.data || [];

                let compliant = 0;
                let nonCompliant = 0;
                let critical = 0;
                const requiredAmount = 3000;

                members.forEach(member => {
                    const balance = member.current_balance || 0;
                    const requiredPayment = Math.max(0, requiredAmount - balance);

                    if (requiredPayment > 1000) {
                        critical++;
                    } else if (requiredPayment > 500) {
                        nonCompliant++;
                    } else {
                        compliant++;
                    }
                });

                const results = `
                    <strong>ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø© (${members.length} Ø¹Ø¶Ùˆ):</strong><br>
                    âœ… Ù…Ù„ØªØ²Ù…ÙˆÙ†: ${compliant} Ø¹Ø¶Ùˆ<br>
                    âš ï¸ ØºÙŠØ± Ù…Ù„ØªØ²Ù…ÙŠÙ†: ${nonCompliant} Ø¹Ø¶Ùˆ<br>
                    âŒ Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø©: ${critical} Ø¹Ø¶Ùˆ<br>
                    <br>
                    <strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ${requiredAmount} Ø±ÙŠØ§Ù„<br>
                    <strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:</strong> ${((compliant / members.length) * 100).toFixed(1)}%
                `;

                showResult('memberDataResult', results, 'success');
            } catch (error) {
                showResult('memberDataResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Test Performance
        async function testPerformance() {
            showResult('performanceResult', 'Ø¬Ø§Ø±ÙŠ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡...', 'info');

            const tests = [
                { limit: 10, name: 'ØµØºÙŠØ±' },
                { limit: 50, name: 'Ù…ØªÙˆØ³Ø·' },
                { limit: 100, name: 'ÙƒØ¨ÙŠØ±' },
                { limit: 500, name: 'Ø¶Ø®Ù…' }
            ];

            let results = '<strong>âš¡ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong><br>';

            for (const test of tests) {
                const startTime = Date.now();

                try {
                    const response = await fetch(`${API_BASE_URL}/api/members?limit=${test.limit}&page=1`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    await response.json();
                    const responseTime = Date.now() - startTime;

                    const performance = responseTime < 500 ? 'ğŸš€ Ù…Ù…ØªØ§Ø²' :
                                      responseTime < 1000 ? 'âœ… Ø¬ÙŠØ¯' :
                                      responseTime < 2000 ? 'âš ï¸ Ù…Ù‚Ø¨ÙˆÙ„' : 'âŒ Ø¨Ø·ÙŠØ¡';

                    results += `â€¢ ${test.name} (${test.limit}): ${responseTime}ms ${performance}<br>`;
                } catch (error) {
                    results += `â€¢ ${test.name} (${test.limit}): âŒ ÙØ´Ù„<br>`;
                }
            }

            showResult('performanceResult', results, 'info');
        }

        // Test with large dataset
        async function testLargeDataSet() {
            showResult('performanceResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©...', 'info');

            try {
                const startTime = Date.now();

                const response = await fetch(`${API_BASE_URL}/api/members?limit=1000&page=1`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;
                const memberCount = data.data?.length || 0;

                const results = `
                    <strong>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©:</strong><br>
                    â€¢ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 1000<br>
                    â€¢ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ÙØ³ØªÙ„Ù…Ø©: ${memberCount}<br>
                    â€¢ Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${responseTime}ms<br>
                    â€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${(memberCount / (responseTime / 1000)).toFixed(0)} Ø¹Ø¶Ùˆ/Ø«Ø§Ù†ÙŠØ©<br>
                    â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${memberCount > 100 ? 'âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©' : 'âš ï¸ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø­Ø¯ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª'}
                `;

                showResult('performanceResult', results, memberCount > 100 ? 'success' : 'warning');
            } catch (error) {
                showResult('performanceResult', `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        // Stress test
        async function testStressLoad() {
            showResult('performanceResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ·... (10 Ø·Ù„Ø¨Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©)', 'info');

            const requests = [];
            const startTime = Date.now();

            for (let i = 0; i < 10; i++) {
                requests.push(
                    fetch(`${API_BASE_URL}/api/members?limit=50&page=${i + 1}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    })
                );
            }

            try {
                const responses = await Promise.all(requests);
                const totalTime = Date.now() - startTime;
                const successCount = responses.filter(r => r.ok).length;

                const results = `
                    <strong>ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ· (10 Ø·Ù„Ø¨Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©):</strong><br>
                    â€¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: ${successCount}/10<br>
                    â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª: ${totalTime}ms<br>
                    â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª Ù„ÙƒÙ„ Ø·Ù„Ø¨: ${(totalTime / 10).toFixed(0)}ms<br>
                    â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${successCount === 10 ? 'âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØªØ­Ù…Ù„ Ø§Ù„Ø¶ØºØ·!' : 'âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙØ´Ù„Øª'}
                `;

                showResult('performanceResult', results, successCount === 10 ? 'success' : 'warning');
            } catch (error) {
                showResult('performanceResult', `âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ·: ${error.message}`, 'error');
            }
        }

        // Complete QA Suite
        async function runCompleteQASuite() {
            const testList = document.getElementById('qaTestList');
            testList.innerHTML = '';

            const tests = [
                { name: 'Ø§ØªØµØ§Ù„ API', fn: testAPIConnection },
                { name: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (347)', fn: checkTotalMembers },
                { name: 'Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', fn: testAuthentication },
                { name: 'Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª', fn: testPagination },
                { name: 'Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª', fn: testPageSizes },
                { name: 'Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', fn: testMemberData },
                { name: 'Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©', fn: testSearchFilter },
                { name: 'Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø±ØµØ¯Ø©', fn: testBalanceCalculations },
                { name: 'Ø§Ù„Ø£Ø¯Ø§Ø¡', fn: testPerformance }
            ];

            let passed = 0;
            let failed = 0;

            for (const test of tests) {
                const li = document.createElement('li');
                li.textContent = `${test.name}...`;
                testList.appendChild(li);

                try {
                    await test.fn();
                    li.className = 'pass';
                    li.textContent = `${test.name} - Ù†Ø¬Ø­`;
                    passed++;
                } catch (error) {
                    li.className = 'fail';
                    li.textContent = `${test.name} - ÙØ´Ù„: ${error.message}`;
                    failed++;
                }

                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            const summary = `
                <div class="result-box ${failed === 0 ? 'success' : 'warning'}">
                    <strong>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„:</strong><br>
                    âœ… Ù†Ø¬Ø­: ${passed} Ø§Ø®ØªØ¨Ø§Ø±<br>
                    âŒ ÙØ´Ù„: ${failed} Ø§Ø®ØªØ¨Ø§Ø±<br>
                    ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${((passed / tests.length) * 100).toFixed(1)}%<br>
                    <br>
                    <strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong> ${
                        failed === 0 ? 'ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!' :
                        failed <= 2 ? 'âš ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„' :
                        'âŒ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ù„Ù‰ Ø¥ØµÙ„Ø§Ø­Ø§Øª'
                    }
                </div>
            `;

            document.getElementById('qaSummary').innerHTML = summary;
        }
    </script>
</body>
</html>
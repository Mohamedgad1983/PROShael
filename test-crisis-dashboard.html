<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Dashboard Testing - Al-Shuail</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Arial', sans-serif;
            background: #f5f5f7;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1d1d1f;
            font-size: 28px;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
        }
        .test-section h2 {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }
        .status {
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            font-weight: 500;
            margin: 5px;
        }
        .status.success {
            background: #d1f4d1;
            color: #0a7c0a;
        }
        .status.error {
            background: #ffd1d1;
            color: #c41e3a;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        .arabic-text {
            font-size: 18px;
            line-height: 1.8;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
            margin: 10px 0;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0051d5;
        }
        .member-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .member-table th,
        .member-table td {
            padding: 10px;
            border: 1px solid #e5e5e7;
            text-align: right;
        }
        .member-table th {
            background: #f5f5f7;
            font-weight: 600;
        }
        .rtl-test {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f0f0f0;
            margin: 10px 0;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ - Ø§Ù„Ø´Ø¹ÙŠÙ„</h1>

        <!-- API Connectivity Test -->
        <div class="test-section">
            <h2>1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Backend API</h2>
            <button onclick="testAPIHealth()">Ø§Ø®ØªØ¨Ø§Ø± Health Check</button>
            <button onclick="testCrisisEndpoint()">Ø§Ø®ØªØ¨Ø§Ø± Crisis Endpoint</button>
            <button onclick="testAuthentication()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
            <div id="api-results"></div>
        </div>

        <!-- Arabic Text Rendering Test -->
        <div class="test-section">
            <h2>2. Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ</h2>
            <div class="arabic-text">
                <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ø¹ÙŠÙ„</p>
                <p>Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ©: Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©Ù </p>
                <p>Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©: 1234567890</p>
                <p>Ù†Øµ Ù…Ø®ØªÙ„Ø·: Ø§Ù„Ø¹Ø¶Ùˆ Ø±Ù‚Ù… 288 - Ø±ØµÙŠØ¯: 3,000 Ø±ÙŠØ§Ù„</p>
                <p>ØªØ´ÙƒÙŠÙ„: Ø§Ù„Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù</p>
            </div>
            <div class="rtl-test">
                <span>ÙŠÙ…ÙŠÙ†</span>
                <span>ÙˆØ³Ø·</span>
                <span>ÙŠØ³Ø§Ø±</span>
            </div>
        </div>

        <!-- Member Data Test -->
        <div class="test-section">
            <h2>3. Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (288 Ø¹Ø¶Ùˆ)</h2>
            <button onclick="testMemberData()">Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
            <button onclick="generateMockData()">ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <div id="member-count"></div>
            <div id="member-table"></div>
        </div>

        <!-- Browser Compatibility -->
        <div class="test-section">
            <h2>4. ØªÙˆØ§ÙÙ‚ Ø§Ù„Ù…ØªØµÙØ­</h2>
            <div id="browser-info"></div>
        </div>

        <!-- Console Output -->
        <div class="test-section">
            <h2>5. Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Console Log</h2>
            <div class="console-output" id="console-log"></div>
        </div>
    </div>

    <script>
        // Console logging
        const consoleLog = document.getElementById('console-log');
        const originalLog = console.log;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog.apply(console, args);
            logToConsole('LOG', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            logToConsole('ERROR', args.join(' '));
        };

        function logToConsole(type, message) {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const color = type === 'ERROR' ? '#ff6b6b' : '#4ecdc4';
            consoleLog.innerHTML += `<div style="color: ${color}">[${timestamp}] ${type}: ${message}</div>`;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        // Browser info
        document.getElementById('browser-info').innerHTML = `
            <p><strong>Ø§Ù„Ù…ØªØµÙØ­:</strong> ${navigator.userAgent}</p>
            <p><strong>Ø§Ù„Ù„ØºØ©:</strong> ${navigator.language}</p>
            <p><strong>Ø§Ù„Ù…Ù†ØµØ©:</strong> ${navigator.platform}</p>
            <p><strong>Ø§Ù„Ø´Ø§Ø´Ø©:</strong> ${window.innerWidth} Ã— ${window.innerHeight}</p>
            <p><strong>Cookies:</strong> ${navigator.cookieEnabled ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}</p>
            <p><strong>LocalStorage:</strong> ${typeof Storage !== 'undefined' ? 'Ù…ØªØ§Ø­' : 'ØºÙŠØ± Ù…ØªØ§Ø­'}</p>
        `;

        // API Testing Functions
        async function testAPIHealth() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>';

            try {
                const response = await fetch('https://proshael.onrender.com/api/health');
                const data = await response.json();

                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="status success">âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    console.log('Health check successful:', data);
                } else {
                    throw new Error('Health check failed');
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</div>`;
                console.error('Health check error:', error);
            }
        }

        async function testCrisisEndpoint() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Crisis Endpoint...</div>';

            const token = localStorage.getItem('token') || 'test-token';

            try {
                const response = await fetch('https://proshael.onrender.com/api/crisis/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    resultsDiv.innerHTML = `<div class="status warning">âš ï¸ ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (401)</div>`;
                } else if (response.status === 404) {
                    resultsDiv.innerHTML = `<div class="status error">âŒ Endpoint ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ (404)</div>`;
                } else if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="status success">âœ… Crisis Endpoint ÙŠØ¹Ù…Ù„</div>
                        <pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£: ${response.status}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</div>`;
                console.error('Crisis endpoint error:', error);
            }
        }

        async function testAuthentication() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...</div>';

            try {
                const response = await fetch('https://proshael.onrender.com/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@alshuail.com',
                        password: 'Admin@2024'
                    })
                });

                const data = await response.json();

                if (data.success && data.token) {
                    localStorage.setItem('token', data.token);
                    resultsDiv.innerHTML = `
                        <div class="status success">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø¬Ø­</div>
                        <p>Token saved to localStorage</p>
                    `;
                    console.log('Login successful');
                } else {
                    resultsDiv.innerHTML = `<div class="status warning">âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${error.message}</div>`;
                console.error('Authentication error:', error);
            }
        }

        // Member Data Testing
        async function testMemberData() {
            const countDiv = document.getElementById('member-count');
            const tableDiv = document.getElementById('member-table');

            countDiv.innerHTML = '<div class="status warning">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>';

            const token = localStorage.getItem('token');
            if (!token) {
                countDiv.innerHTML = '<div class="status error">âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</div>';
                return;
            }

            try {
                const response = await fetch('https://proshael.onrender.com/api/crisis/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const members = data.data?.members || data.members || [];

                    countDiv.innerHTML = `
                        <div class="status success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${members.length} Ø¹Ø¶Ùˆ</div>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${data.data?.statistics?.totalMembers || members.length}</p>
                        <p>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ù„ØªØ²Ù…ÙˆÙ†: ${data.data?.statistics?.compliantMembers || 0}</p>
                        <p>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…Ù„ØªØ²Ù…ÙŠÙ†: ${data.data?.statistics?.nonCompliantMembers || 0}</p>
                    `;

                    // Display first 10 members in table
                    if (members.length > 0) {
                        let tableHTML = `
                            <table class="member-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</th>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;

                        members.slice(0, 10).forEach((member, index) => {
                            const statusClass = member.status === 'sufficient' ? 'success' : 'error';
                            tableHTML += `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${member.memberId || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${member.fullName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${member.balance?.toLocaleString() || 0} Ø±ÙŠØ§Ù„</td>
                                    <td><span class="status ${statusClass}">${member.status === 'sufficient' ? 'Ù…Ù„ØªØ²Ù…' : 'ØºÙŠØ± Ù…Ù„ØªØ²Ù…'}</span></td>
                                </tr>
                            `;
                        });

                        tableHTML += '</tbody></table>';
                        tableDiv.innerHTML = tableHTML;
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                countDiv.innerHTML = `<div class="status error">âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}</div>`;
                console.error('Member data error:', error);
            }
        }

        function generateMockData() {
            const members = [];
            for (let i = 1; i <= 288; i++) {
                members.push({
                    id: i,
                    memberId: `SH-${10000 + i}`,
                    fullName: `Ø¹Ø¶Ùˆ Ø±Ù‚Ù… ${i}`,
                    balance: Math.round(Math.random() * 5000),
                    status: Math.random() > 0.5 ? 'sufficient' : 'insufficient'
                });
            }

            document.getElementById('member-count').innerHTML = `
                <div class="status success">âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ 288 Ø¹Ø¶Ùˆ ØªØ¬Ø±ÙŠØ¨ÙŠ</div>
            `;

            console.log('Generated mock data:', members.length, 'members');
        }

        // Initial test on load
        window.addEventListener('load', () => {
            console.log('Page loaded successfully');
            console.log('Testing Arabic text rendering...');

            // Check if localStorage has token
            if (localStorage.getItem('token')) {
                console.log('Token found in localStorage');
            } else {
                console.log('No token found - authentication required');
            }
        });

        // Catch all errors
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });
    </script>
</body>
</html>
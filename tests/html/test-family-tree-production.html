<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Production API Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .api-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            margin: 10px;
        }

        .status-online {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .status-offline {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            transition: transform 0.3s;
        }

        .test-card:hover {
            transform: translateY(-5px);
        }

        .test-card h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .method-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: auto;
        }

        .method-get { background: #4CAF50; }
        .method-post { background: #2196F3; }
        .method-put { background: #FF9800; }
        .method-delete { background: #f44336; }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
            margin: 5px 0;
        }

        button:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-group {
            margin: 10px 0;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            margin-top: 5px;
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            position: relative;
        }

        .result-box.show {
            display: block;
        }

        .result-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            margin: 0;
            direction: ltr;
            text-align: left;
        }

        .success-result {
            border-right: 4px solid #4CAF50;
        }

        .error-result {
            border-right: 4px solid #f44336;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .quick-test {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .test-members {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .member-chip {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .member-chip:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .endpoint-url {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            direction: ltr;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ³ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Production API</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</p>
            <div id="apiStatus" class="api-status">
                <span id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</span>
            </div>
            <div class="api-status">
                <span>Production: https://proshael.onrender.com</span>
            </div>
        </div>

        <!-- Quick Test Section -->
        <div class="quick-test">
            <h3>ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ - Quick Test</h3>
            <p>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ø¶Ùˆ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø¬Ø±Ø© Ø¹Ø§Ø¦Ù„ØªÙ‡:</p>
            <div class="test-members">
                <div class="member-chip" onclick="quickTestMember('e1613c27-9f24-42b9-834e-cad9f5a563c5', 'Ù…Ø­Ù…Ø¯')">
                    Ù…Ø­Ù…Ø¯ (e1613c27...)
                </div>
                <div class="member-chip" onclick="quickTestMember('0d6b0159-afcb-49d2-a91a-e93bd383a3ee', 'Test Member')">
                    Test Member (0d6b0159...)
                </div>
                <div class="member-chip" onclick="quickTestMember('8152bbac-7906-4d64-8d27-4a5cdae87d3d', 'Admin')">
                    Admin (8152bbac...)
                </div>
            </div>
            <div id="quickResult" class="result-box" style="margin-top: 20px;"></div>
        </div>

        <!-- Login Section -->
        <div class="test-card">
            <h3>
                ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Authentication
                <span class="method-badge method-post">POST</span>
            </h3>
            <div class="endpoint-url">/api/auth/login</div>
            <div class="input-group">
                <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="admin@alshuail.com">
            </div>
            <div class="input-group">
                <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="">
            </div>
            <button onclick="performLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="loginResult" class="result-box"></div>
        </div>

        <!-- Test Grid -->
        <div class="test-grid">
            <!-- Search Members -->
            <div class="test-card">
                <h3>
                    ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
                    <span class="method-badge method-get">GET</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/search?query={text}</div>
                <div class="input-group">
                    <input type="text" id="searchQuery" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ù‡Ø§ØªÙ" value="Ù…Ø­Ù…Ø¯">
                </div>
                <button onclick="searchMembers()">Ø¨Ø­Ø«</button>
                <div id="searchResult" class="result-box"></div>
            </div>

            <!-- Get Member Family Tree -->
            <div class="test-card">
                <h3>
                    ğŸ‘¤ Ø´Ø¬Ø±Ø© Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
                    <span class="method-badge method-get">GET</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/member/{memberId}</div>
                <div class="input-group">
                    <input type="text" id="memberId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ (UUID)" value="e1613c27-9f24-42b9-834e-cad9f5a563c5">
                </div>
                <button onclick="getMemberTree()">Ø¬Ù„Ø¨ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</button>
                <div id="memberTreeResult" class="result-box"></div>
                <div id="memberStats" class="stats-grid" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-value" id="statParents">0</div>
                        <div class="stat-label">Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statChildren">0</div>
                        <div class="stat-label">Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statSpouses">0</div>
                        <div class="stat-label">Ø§Ù„Ø£Ø²ÙˆØ§Ø¬</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statSiblings">0</div>
                        <div class="stat-label">Ø§Ù„Ø¥Ø®ÙˆØ©</div>
                    </div>
                </div>
            </div>

            <!-- Get Visualization Structure -->
            <div class="test-card">
                <h3>
                    ğŸ“Š Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªØµÙˆØ± Ø§Ù„Ù…Ø±Ø¦ÙŠ
                    <span class="method-badge method-get">GET</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/visualization/{memberId}?depth={n}</div>
                <div class="input-group">
                    <input type="text" id="vizMemberId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ (UUID)" value="e1613c27-9f24-42b9-834e-cad9f5a563c5">
                </div>
                <div class="input-group">
                    <select id="vizDepth">
                        <option value="1">Ø¹Ù…Ù‚ 1 (Ø¬ÙŠÙ„ ÙˆØ§Ø­Ø¯)</option>
                        <option value="2" selected>Ø¹Ù…Ù‚ 2 (Ø¬ÙŠÙ„Ø§Ù†)</option>
                        <option value="3">Ø¹Ù…Ù‚ 3 (Ø«Ù„Ø§Ø«Ø© Ø£Ø¬ÙŠØ§Ù„)</option>
                        <option value="4">Ø¹Ù…Ù‚ 4 (Ø£Ø±Ø¨Ø¹Ø© Ø£Ø¬ÙŠØ§Ù„)</option>
                    </select>
                </div>
                <button onclick="getVisualization()">Ø¬Ù„Ø¨ Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªØµÙˆØ±</button>
                <div id="vizResult" class="result-box"></div>
            </div>

            <!-- Add Relationship -->
            <div class="test-card">
                <h3>
                    â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©
                    <span class="method-badge method-post">POST</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/relationship</div>
                <div class="input-group">
                    <input type="text" id="memberFrom" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø£ÙˆÙ„">
                </div>
                <div class="input-group">
                    <input type="text" id="memberTo" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø«Ø§Ù†ÙŠ">
                </div>
                <div class="input-group">
                    <select id="relationshipType">
                        <option value="father">Ø£Ø¨</option>
                        <option value="mother">Ø£Ù…</option>
                        <option value="spouse">Ø²ÙˆØ¬/Ø²ÙˆØ¬Ø©</option>
                        <option value="child">Ø§Ø¨Ù†/Ø§Ø¨Ù†Ø©</option>
                        <option value="sibling">Ø£Ø®/Ø£Ø®Øª</option>
                    </select>
                </div>
                <div class="input-group">
                    <input type="date" id="marriageDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙˆØ§Ø¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                <button onclick="addRelationship()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©</button>
                <div id="addRelResult" class="result-box"></div>
            </div>

            <!-- Update Relationship -->
            <div class="test-card">
                <h3>
                    âœï¸ ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ø§Ù‚Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©
                    <span class="method-badge method-put">PUT</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/relationship/{id}</div>
                <div class="input-group">
                    <input type="text" id="updateRelId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©">
                </div>
                <div class="input-group">
                    <textarea id="updateData" placeholder='{"marriage_date": "2024-01-01"}' rows="3"></textarea>
                </div>
                <button onclick="updateRelationship()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©</button>
                <div id="updateResult" class="result-box"></div>
            </div>

            <!-- Delete Relationship -->
            <div class="test-card">
                <h3>
                    ğŸ—‘ï¸ Ø­Ø°Ù Ø¹Ù„Ø§Ù‚Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©
                    <span class="method-badge method-delete">DELETE</span>
                </h3>
                <div class="endpoint-url">/api/family-tree/relationship/{id}</div>
                <div class="input-group">
                    <input type="text" id="deleteRelId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©">
                </div>
                <button onclick="deleteRelationship()">Ø­Ø°Ù Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© (Ø­Ø°Ù Ù†Ø§Ø¹Ù…)</button>
                <div id="deleteResult" class="result-box"></div>
            </div>
        </div>

        <!-- Batch Testing -->
        <div class="test-card">
            <h3>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ - Comprehensive Test</h3>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©</p>
            <button onclick="runAllTests()">ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <div id="batchResult" class="result-box"></div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = 'https://proshael.onrender.com';
        const LOCAL_API_URL = 'http://localhost:3001';
        let useProduction = true;
        let authToken = localStorage.getItem('familyTreeToken') || '';

        // Get the active API URL
        function getApiUrl() {
            return useProduction ? API_URL : LOCAL_API_URL;
        }

        // Check API Status
        async function checkApiStatus() {
            try {
                const response = await fetch(`${getApiUrl()}/api/health`);
                const statusEl = document.getElementById('apiStatus');
                const statusText = document.getElementById('statusText');

                if (response.ok) {
                    statusEl.className = 'api-status status-online';
                    statusText.textContent = 'âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ù…ØªØµÙ„';
                } else {
                    statusEl.className = 'api-status status-offline';
                    statusText.textContent = 'âŒ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„';
                }
            } catch (error) {
                const statusEl = document.getElementById('apiStatus');
                const statusText = document.getElementById('statusText');
                statusEl.className = 'api-status status-offline';
                statusText.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
            }
        }

        // Display result in a result box
        function displayResult(elementId, data, isSuccess = true) {
            const resultBox = document.getElementById(elementId);
            resultBox.className = `result-box show ${isSuccess ? 'success-result' : 'error-result'}`;

            // Add copy button
            resultBox.innerHTML = `
                <button class="copy-btn" onclick="copyToClipboard('${elementId}')">ğŸ“‹ Ù†Ø³Ø®</button>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }

        // Copy to clipboard
        function copyToClipboard(elementId) {
            const resultBox = document.getElementById(elementId);
            const text = resultBox.querySelector('pre').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!');
            });
        }

        // Login
        async function performLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${getApiUrl()}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok && data.token) {
                    authToken = data.token;
                    localStorage.setItem('familyTreeToken', authToken);
                    displayResult('loginResult', {
                        success: true,
                        message: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!',
                        user: data.user,
                        tokenPrefix: authToken.substring(0, 20) + '...'
                    }, true);
                } else {
                    displayResult('loginResult', data, false);
                }
            } catch (error) {
                displayResult('loginResult', { error: error.message }, false);
            }
        }

        // Search Members
        async function searchMembers() {
            const query = document.getElementById('searchQuery').value;
            if (!query) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«');
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/search?query=${encodeURIComponent(query)}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                displayResult('searchResult', data, response.ok);
            } catch (error) {
                displayResult('searchResult', { error: error.message }, false);
            }
        }

        // Get Member Family Tree
        async function getMemberTree() {
            const memberId = document.getElementById('memberId').value;
            if (!memberId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ');
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/member/${memberId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                displayResult('memberTreeResult', data, response.ok);

                // Update statistics if successful
                if (response.ok && data.data && data.data.statistics) {
                    const stats = data.data.statistics;
                    document.getElementById('memberStats').style.display = 'grid';
                    document.getElementById('statParents').textContent = stats.total_parents || 0;
                    document.getElementById('statChildren').textContent = stats.total_children || 0;
                    document.getElementById('statSpouses').textContent = stats.total_spouses || 0;
                    document.getElementById('statSiblings').textContent = stats.total_siblings || 0;
                }
            } catch (error) {
                displayResult('memberTreeResult', { error: error.message }, false);
            }
        }

        // Get Visualization Structure
        async function getVisualization() {
            const memberId = document.getElementById('vizMemberId').value;
            const depth = document.getElementById('vizDepth').value;

            if (!memberId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ');
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/visualization/${memberId}?depth=${depth}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                displayResult('vizResult', data, response.ok);
            } catch (error) {
                displayResult('vizResult', { error: error.message }, false);
            }
        }

        // Add Relationship
        async function addRelationship() {
            const memberFrom = document.getElementById('memberFrom').value;
            const memberTo = document.getElementById('memberTo').value;
            const relationshipType = document.getElementById('relationshipType').value;
            const marriageDate = document.getElementById('marriageDate').value;

            if (!memberFrom || !memberTo) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡');
                return;
            }

            const relationshipNames = {
                father: { ar: 'Ø£Ø¨', en: 'Father' },
                mother: { ar: 'Ø£Ù…', en: 'Mother' },
                spouse: { ar: 'Ø²ÙˆØ¬/Ø²ÙˆØ¬Ø©', en: 'Spouse' },
                child: { ar: 'Ø§Ø¨Ù†/Ø§Ø¨Ù†Ø©', en: 'Child' },
                sibling: { ar: 'Ø£Ø®/Ø£Ø®Øª', en: 'Sibling' }
            };

            const body = {
                member_from: memberFrom,
                member_to: memberTo,
                relationship_type: relationshipType,
                relationship_name_ar: relationshipNames[relationshipType].ar,
                relationship_name_en: relationshipNames[relationshipType].en
            };

            if (marriageDate && relationshipType === 'spouse') {
                body.marriage_date = marriageDate;
            }

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/relationship`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResult('addRelResult', data, response.ok);
            } catch (error) {
                displayResult('addRelResult', { error: error.message }, false);
            }
        }

        // Update Relationship
        async function updateRelationship() {
            const relId = document.getElementById('updateRelId').value;
            const updateData = document.getElementById('updateData').value;

            if (!relId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©');
                return;
            }

            try {
                const body = updateData ? JSON.parse(updateData) : {};

                const response = await fetch(`${getApiUrl()}/api/family-tree/relationship/${relId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResult('updateResult', data, response.ok);
            } catch (error) {
                displayResult('updateResult', { error: error.message }, false);
            }
        }

        // Delete Relationship
        async function deleteRelationship() {
            const relId = document.getElementById('deleteRelId').value;

            if (!relId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©');
                return;
            }

            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©ØŸ')) {
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/relationship/${relId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                displayResult('deleteResult', data, response.ok);
            } catch (error) {
                displayResult('deleteResult', { error: error.message }, false);
            }
        }

        // Quick Test Member
        async function quickTestMember(memberId, memberName) {
            const resultBox = document.getElementById('quickResult');
            resultBox.className = 'result-box show';
            resultBox.innerHTML = `<div class="loading show"><div class="spinner"></div>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ${memberName}...</div>`;

            try {
                const response = await fetch(`${getApiUrl()}/api/family-tree/member/${memberId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (response.ok && data.data) {
                    const tree = data.data;
                    const stats = tree.statistics;

                    let summary = `ğŸ“Š Ù…Ù„Ø®Øµ Ø´Ø¬Ø±Ø© Ø¹Ø§Ø¦Ù„Ø© ${memberName}:\n`;
                    summary += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                    summary += `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${tree.member.full_name || memberName}\n`;
                    summary += `ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${tree.member.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    summary += `ğŸ˜ï¸ Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©: ${tree.member.tribal_section || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n\n`;
                    summary += `ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\n`;
                    summary += `  â€¢ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†: ${stats.total_parents}\n`;
                    summary += `  â€¢ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡: ${stats.total_children}\n`;
                    summary += `  â€¢ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬: ${stats.total_spouses}\n`;
                    summary += `  â€¢ Ø§Ù„Ø¥Ø®ÙˆØ©: ${stats.total_siblings}\n`;
                    summary += `  â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©: ${stats.total_family_members}\n`;
                    summary += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
                    summary += `Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©:\n${JSON.stringify(data, null, 2)}`;

                    resultBox.className = 'result-box show success-result';
                    resultBox.innerHTML = `
                        <button class="copy-btn" onclick="copyToClipboard('quickResult')">ğŸ“‹ Ù†Ø³Ø®</button>
                        <pre>${summary}</pre>
                    `;
                } else {
                    displayResult('quickResult', data, false);
                }
            } catch (error) {
                displayResult('quickResult', { error: error.message }, false);
            }
        }

        // Run All Tests
        async function runAllTests() {
            const resultBox = document.getElementById('batchResult');
            resultBox.className = 'result-box show';
            let results = [];

            // Test 1: Search
            resultBox.innerHTML = '<div class="loading show"><div class="spinner"></div>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø«...</div>';
            try {
                const searchResp = await fetch(`${getApiUrl()}/api/family-tree/search?query=Ù…Ø­Ù…Ø¯`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const searchData = await searchResp.json();
                results.push({
                    test: 'Search API',
                    endpoint: '/api/family-tree/search',
                    status: searchResp.ok ? 'âœ… Success' : 'âŒ Failed',
                    data: searchData
                });
            } catch (error) {
                results.push({
                    test: 'Search API',
                    status: 'âŒ Error',
                    error: error.message
                });
            }

            // Test 2: Member Tree
            resultBox.innerHTML = '<div class="loading show"><div class="spinner"></div>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©...</div>';
            try {
                const treeResp = await fetch(`${getApiUrl()}/api/family-tree/member/e1613c27-9f24-42b9-834e-cad9f5a563c5`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const treeData = await treeResp.json();
                results.push({
                    test: 'Member Tree API',
                    endpoint: '/api/family-tree/member/{id}',
                    status: treeResp.ok ? 'âœ… Success' : 'âŒ Failed',
                    hasRelationships: treeData.data ? Object.keys(treeData.data.relationships).length : 0
                });
            } catch (error) {
                results.push({
                    test: 'Member Tree API',
                    status: 'âŒ Error',
                    error: error.message
                });
            }

            // Test 3: Visualization
            resultBox.innerHTML = '<div class="loading show"><div class="spinner"></div>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØµÙˆØ± Ø§Ù„Ù…Ø±Ø¦ÙŠ...</div>';
            try {
                const vizResp = await fetch(`${getApiUrl()}/api/family-tree/visualization/e1613c27-9f24-42b9-834e-cad9f5a563c5?depth=2`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const vizData = await vizResp.json();
                results.push({
                    test: 'Visualization API',
                    endpoint: '/api/family-tree/visualization/{id}',
                    status: vizResp.ok ? 'âœ… Success' : 'âŒ Failed',
                    hasData: vizData.data ? true : false
                });
            } catch (error) {
                results.push({
                    test: 'Visualization API',
                    status: 'âŒ Error',
                    error: error.message
                });
            }

            // Display all results
            resultBox.className = 'result-box show success-result';
            resultBox.innerHTML = `
                <button class="copy-btn" onclick="copyToClipboard('batchResult')">ğŸ“‹ Ù†Ø³Ø®</button>
                <pre>${JSON.stringify(results, null, 2)}</pre>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkApiStatus();
            // Check API status every 30 seconds
            setInterval(checkApiStatus, 30000);

            // Load saved token
            if (authToken) {
                console.log('Token loaded from localStorage');
            }
        });
    </script>
</body>
</html>
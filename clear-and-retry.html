<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ - AL-SHUAIL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        .emoji {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }
        .status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #667eea;
        }
        .status.success {
            border-right-color: #10b981;
            background: #ecfdf5;
        }
        .status.error {
            border-right-color: #ef4444;
            background: #fef2f2;
        }
        button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        .btn-danger {
            background: #fef2f2;
            color: #ef4444;
            border: 2px solid #fee2e2;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .info-box {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }
        .info-box p {
            color: #3730a3;
            line-height: 1.6;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="emoji">ğŸ”§</div>
        <h1>Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h1>

        <div class="info-box">
            <h3>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</h3>
            <p>ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø³Ø¨Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­</p>
        </div>

        <div id="status-message"></div>

        <button class="btn-primary" onclick="clearAndFix()">
            ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
        </button>

        <button class="btn-secondary" onclick="checkCurrentData()">
            ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        </button>

        <button class="btn-danger" onclick="forceLogout()">
            ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙƒØ§Ù…Ù„
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­...</p>
        </div>

        <div id="login-section" class="hidden">
            <hr style="margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;">
            <h2 style="text-align: center; margin-bottom: 20px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
            <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„" value="0555555555" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123456" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px;">
            <button class="btn-success" onclick="directLogin()">
                ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
        </div>
    </div>

    <script>
        const API_URL = 'https://proshael.onrender.com';
        const FRONTEND_URL = 'https://alshuail-admin.pages.dev';

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        function checkCurrentData() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            const memberData = localStorage.getItem('memberData');

            let status = '<h3>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</h3><ul style="margin: 10px 0; padding-right: 20px;">';

            if (token) {
                status += `<li>âœ… Token Ù…ÙˆØ¬ÙˆØ¯ (${token.substring(0, 20)}...)</li>`;

                // Check if token is valid
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const exp = new Date(payload.exp * 1000);
                    const now = new Date();
                    if (exp > now) {
                        status += `<li>âœ… Token ØµØ§Ù„Ø­ Ø­ØªÙ‰ ${exp.toLocaleString('ar-SA')}</li>`;
                    } else {
                        status += '<li>âŒ Token Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</li>';
                    }
                } catch (e) {
                    status += '<li>âš ï¸ Token ØºÙŠØ± ØµØ§Ù„Ø­</li>';
                }
            } else {
                status += '<li>âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Token</li>';
            }

            if (user) {
                try {
                    const userData = JSON.parse(user);
                    status += `<li>âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.name} (${userData.role})</li>`;
                } catch (e) {
                    status += '<li>âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ§Ù„ÙØ©</li>';
                }
            } else {
                status += '<li>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…</li>';
            }

            if (memberData) {
                status += '<li>âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©</li>';
            }

            status += '</ul>';
            showStatus(status);
        }

        async function clearAndFix() {
            document.getElementById('loading').classList.add('active');

            // Step 1: Clear all data
            showStatus('Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...', 'info');
            localStorage.clear();
            sessionStorage.clear();

            // Clear cookies
            document.cookie.split(";").forEach(function(c) {
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });

            await new Promise(resolve => setTimeout(resolve, 1000));

            // Step 2: Test backend
            showStatus('Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø®Ø§Ø¯Ù…...', 'info');
            try {
                const response = await fetch(`${API_URL}/api/health`);
                if (response.ok) {
                    showStatus('âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'success');
                }
            } catch (e) {
                showStatus('âš ï¸ Ø§Ù„Ø®Ø§Ø¯Ù… Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø¨Ø·ÙŠØ¦Ø§Ù‹ØŒ Ù„ÙƒÙ† Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ', 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 1000));

            // Step 3: Show login section
            document.getElementById('loading').classList.remove('active');
            document.getElementById('login-section').classList.remove('hidden');
            showStatus('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†', 'success');
        }

        async function directLogin() {
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;

            document.getElementById('loading').classList.add('active');
            showStatus('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');

            try {
                const response = await fetch(`${API_URL}/api/auth/mobile-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, password })
                });

                const data = await response.json();

                if (data.success && data.token) {
                    // Store correctly
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    localStorage.setItem('memberData', JSON.stringify(data.user));

                    showStatus(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data.user.name}`, 'success');

                    // Wait a bit then redirect
                    setTimeout(() => {
                        window.location.href = `${FRONTEND_URL}/mobile/dashboard`;
                    }, 2000);
                } else {
                    showStatus(`âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${data.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        }

        function forceLogout() {
            localStorage.clear();
            sessionStorage.clear();
            showStatus('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                window.location.href = `${FRONTEND_URL}/mobile/login`;
            }, 1500);
        }

        // Check on load
        window.onload = () => {
            checkCurrentData();
        };
    </script>
</body>
</html>

> alshuail-backend@1.0.0 test
> cross-env NODE_OPTIONS=--experimental-vm-modules jest

2025-10-11 10:34:34 [[31merror[39m]: [31mError occurred:[39m
2025-10-11 10:34:34 [[31merror[39m]: [31mError occurred: JWT verification failed[39m
2025-10-11 10:34:34 [[31merror[39m]: [31mError occurred: duplicate key value[39m
2025-10-11 10:34:34 [[31merror[39m]: [31mError occurred: connection timeout[39m
2025-10-11 10:34:34 [[31merror[39m]: [31mError occurred: Unknown error occurred[39m
(node:25688) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/unit/utils/errorCodes.test.js
  ErrorCodes Utility
    ErrorCodes Structure
      âˆš should have all required properties for each error code (56 ms)
      âˆš should have unique error codes (2 ms)
      âˆš should use correct HTTP status codes (5 ms)
      âˆš should have bilingual messages (English and Arabic) (22 ms)
    createErrorResponse
      âˆš should create error response with valid error key (2 ms)
      âˆš should fallback to SYSTEM_ERROR for invalid error key (1 ms)
      âˆš should include additional info in error response (1 ms)
      âˆš should include ISO timestamp (2 ms)
    errorHandler middleware
      âˆš should handle known error codes (7 ms)
      âˆš should handle JWT errors with AUTH_TOKEN_INVALID (5 ms)
      âˆš should handle duplicate entry errors (3 ms)
      âˆš should handle timeout errors (2 ms)
      âˆš should default to SYSTEM_ERROR for unknown errors (3 ms)
    asyncErrorWrapper
      âˆš should call function and handle success (1 ms)
      âˆš should catch errors and call next (2 ms)
      âˆš should handle synchronous errors (1 ms)

(node:12024) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/unit/services/receiptService.test.js
  ReceiptService
    numberToWords
      Arabic Number Conversion
        âˆš should convert integer amounts to Arabic (9 ms)
        âˆš should convert decimal amounts to Arabic (2 ms)
        âˆš should handle zero decimals (2 ms)
        âˆš should handle various decimal amounts (2 ms)
      English Number Conversion
        âˆš should convert integer amounts to English (1 ms)
        âˆš should convert decimal amounts to English (1 ms)
        âˆš should handle singular for single riyal (1 ms)
        âˆš should handle plural correctly (1 ms)
    translateCategory
      Arabic Translation
        âˆš should translate subscription to Arabic (1 ms)
        âˆš should translate donation to Arabic (3 ms)
        âˆš should translate event to Arabic (34 ms)
        âˆš should translate membership to Arabic (1 ms)
        âˆš should translate diya to Arabic (1 ms)
        âˆš should translate other to Arabic (1 ms)
        âˆš should return original for unknown category in Arabic (1 ms)
      English Translation
        âˆš should translate subscription to English
        âˆš should translate donation to English (1 ms)
        âˆš should return original for unknown category in English (1 ms)
    translatePaymentMethod
      Arabic Translation
        âˆš should translate cash to Arabic (1 ms)
        âˆš should translate card to Arabic (1 ms)
        âˆš should translate transfer to Arabic (1 ms)
        âˆš should translate online to Arabic (1 ms)
        âˆš should translate check to Arabic (1 ms)
      English Translation
        âˆš should translate cash to English (1 ms)
        âˆš should translate card to English (9 ms)
        âˆš should translate transfer to English (1 ms)
    translateStatus
      Arabic Translation
        âˆš should translate paid to Arabic (1 ms)
        âˆš should translate pending to Arabic
        âˆš should translate cancelled to Arabic
        âˆš should translate failed to Arabic (1 ms)
        âˆš should translate refunded to Arabic
      English Translation
        âˆš should translate paid to English (1 ms)
        âˆš should translate pending to English (2 ms)
        âˆš should translate cancelled to English
    getOrganizationDetails
      âˆš should return Arabic organization details (2 ms)
      âˆš should return English organization details (1 ms)
      âˆš should have consistent contact information
    generateReceiptData
      âˆš should generate receipt data in Arabic (33 ms)
      âˆš should generate receipt data in English (2 ms)
      âˆš should include payer information (2 ms)
      âˆš should include payment details (1 ms)
      âˆš should handle missing payer information
      âˆš should translate amount to words (1 ms)
      âˆš should include timestamps (1 ms)

(node:23640) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:27044) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:31392) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:28800) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS __tests__/unit/services/paymentProcessing.test.js
  PaymentProcessingService
    generateReferenceNumber
      âˆš should generate reference number with SH prefix (4 ms)
      âˆš should generate unique reference numbers (1 ms)
      âˆš should include timestamp in reference number (2 ms)
    validatePaymentAmount
      Basic Validation
        âˆš should accept valid positive amounts (1 ms)
        âˆš should reject zero amount (1 ms)
        âˆš should reject negative amounts (10 ms)
        âˆš should reject non-numeric amounts (1 ms)
        âˆš should reject amounts exceeding maximum (100,000 SAR)
        âˆš should accept maximum amount (100,000 SAR)
      Subscription Category Validation
        âˆš should accept minimum subscription amount (50 SAR) (1 ms)
        âˆš should reject subscription below minimum (50 SAR) (1 ms)
        âˆš should accept subscription multiples of 50 (1 ms)
        âˆš should reject subscription not multiple of 50 (1 ms)
        âˆš should handle decimal subscriptions correctly (1 ms)
      Event Category Validation
        âˆš should accept minimum event amount (10 SAR) (1 ms)
        âˆš should reject event below minimum (10 SAR)
        âˆš should accept various event amounts (1 ms)
      Other Categories
        âˆš should accept any valid amount for donation category (1 ms)
        âˆš should accept any valid amount for membership category (1 ms)
        âˆš should accept any valid amount for diya category
      Edge Cases
        âˆš should handle string numbers correctly
        âˆš should handle decimal amounts (1 ms)
        âˆš should return error for validation exception
    sanitizeDescription
      âˆš should remove HTML tags (1 ms)
      âˆš should remove script tags and content (1 ms)
      âˆš should remove dangerous characters (1 ms)
      âˆš should trim whitespace
      âˆš should limit length to 500 characters (1 ms)
      âˆš should return empty string for null/undefined (1 ms)
      âˆš should preserve Arabic text
      âˆš should handle mixed Arabic and English
    Integration Scenarios
      âˆš should validate complete payment workflow (1 ms)
      âˆš should handle subscription calculation correctly (1 ms)

FAIL __tests__/integration/controllers/expenses.test.js
  Expenses Controller Integration Tests
    GET /api/expenses
      âˆš should require authentication (43 ms)
      âˆš should deny access to non-financial managers (17 ms)
      Ã— should allow financial managers to view expenses (14 ms)
      Ã— should return expenses with summary statistics (11 ms)
      âˆš should support category filtering (12 ms)
      âˆš should support status filtering (14 ms)
      âˆš should support Hijri date filtering (10 ms)
      âˆš should support search functionality (9 ms)
      Ã— should include pagination information (12 ms)
    POST /api/expenses
      âˆš should require authentication (19 ms)
      Ã— should deny access to members (10 ms)
      Ã— should require all required fields (15 ms)
      Ã— should auto-approve for financial managers (12 ms)
      Ã— should generate Hijri dates automatically (11 ms)
    GET /api/expenses/statistics
      âˆš should require authentication (5 ms)
      âˆš should deny access to non-financial managers (8 ms)
      Ã— should return comprehensive statistics (12 ms)
      Ã— should support period filtering (11 ms)
      Ã— should support Hijri year filtering (12 ms)
    RBAC and Access Control
      âˆš should log financial access attempts (9 ms)
      âˆš should block non-financial users consistently (20 ms)

  â— Expenses Controller Integration Tests â€º GET /api/expenses â€º should allow financial managers to view expenses

    expect(received).toHaveProperty(path)

    Expected path: "expenses"
    Received path: []

    Received value: {"data": {"expenses": [{"amount": 1500, "approved_at": "2024-01-16T14:00:00Z", "approved_by_name": "Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙˆØ¯", "category": "supplies", "created_at": "2024-01-15T10:00:00Z", "created_by_name": "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯", "date": "2024-01-15", "description_ar": "Ø´Ø±Ø§Ø¡ Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ© Ù„Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "description_en": "Purchase of office supplies for main office", "hijri_date": "1445/07/03", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440001", "invoice_number": "INV-2024-001", "notes": "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", "payment_method": "cash", "status": "approved", "title_ar": "Ø´Ø±Ø§Ø¡ Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ©", "title_en": "Office Supplies Purchase", "vendor": "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø¹ÙŠÙ„"}, {"amount": 3200, "category": "maintenance", "created_at": "2024-01-20T09:00:00Z", "created_by_name": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", "date": "2024-01-20", "description_ar": "ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ù…ÙƒÙŠÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "description_en": "Periodic maintenance for AC units in main building", "hijri_date": "1445/07/08", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440002", "invoice_number": "INV-2024-002", "notes": "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©", "payment_method": "bank_transfer", "status": "pending", "title_ar": "ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ÙƒÙŠÙØ§Øª", "title_en": "AC Maintenance", "vendor": "Ø´Ø±ÙƒØ© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©"}, {"amount": 850, "approved_at": "2024-01-25T15:00:00Z", "approved_by_name": "Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙˆØ¯", "category": "utilities", "created_at": "2024-01-25T11:00:00Z", "created_by_name": "Ø³Ø¹Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯", "date": "2024-01-25", "description_ar": "ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø¨Ù†Ù‰", "description_en": "Monthly electricity bill for the building", "hijri_date": "1445/07/13", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440003", "invoice_number": "ELEC-2024-001", "notes": "Ø¯ÙØ¹Øª Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©", "payment_method": "online", "status": "approved", "title_ar": "ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡", "title_en": "Electricity Bill", "vendor": "Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡"}, {"amount": 5000, "category": "activities", "created_at": "2024-03-10T10:00:00Z", "created_by_name": "ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ", "date": "2024-03-15", "description_ar": "ØªÙ†Ø¸ÙŠÙ… Ø¥ÙØ·Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†", "description_en": "Organizing group iftar for members in Ramadan", "hijri_date": "1445/09/05", "hijri_month": 9, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440004", "invoice_number": "RAM-2024-001", "notes": "Ù…Ø±ÙÙˆØ¶ - ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø£Ù‚Ù„", "payment_method": "cash", "rejection_reason": "ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©", "status": "rejected", "title_ar": "Ù†Ø´Ø§Ø· Ø±Ù…Ø¶Ø§Ù†ÙŠ", "title_en": "Ramadan Activity", "vendor": "Ù…Ø·Ø¹Ù… Ø§Ù„Ø¶ÙŠØ§ÙØ©"}], "metadata": {"limit": 50, "page": 1, "total_pages": 1}, "total_amount": 10550, "total_count": 4}, "message_ar": "ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­", "success": true}

    [0m [90m 74 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 75 |[39m       expect(response[33m.[39mbody)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 76 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'expenses'[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 77 |[39m       expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39mexpenses))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 78 |[39m     })[33m;[39m
     [90m 79 |[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:76:29)

  â— Expenses Controller Integration Tests â€º GET /api/expenses â€º should return expenses with summary statistics

    expect(received).toHaveProperty(path)

    Expected path: "expenses"
    Received path: []

    Received value: {"data": {"expenses": [{"amount": 1500, "approved_at": "2024-01-16T14:00:00Z", "approved_by_name": "Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙˆØ¯", "category": "supplies", "created_at": "2024-01-15T10:00:00Z", "created_by_name": "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯", "date": "2024-01-15", "description_ar": "Ø´Ø±Ø§Ø¡ Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ© Ù„Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "description_en": "Purchase of office supplies for main office", "hijri_date": "1445/07/03", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440001", "invoice_number": "INV-2024-001", "notes": "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", "payment_method": "cash", "status": "approved", "title_ar": "Ø´Ø±Ø§Ø¡ Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ©", "title_en": "Office Supplies Purchase", "vendor": "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø¹ÙŠÙ„"}, {"amount": 3200, "category": "maintenance", "created_at": "2024-01-20T09:00:00Z", "created_by_name": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", "date": "2024-01-20", "description_ar": "ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ù…ÙƒÙŠÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "description_en": "Periodic maintenance for AC units in main building", "hijri_date": "1445/07/08", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440002", "invoice_number": "INV-2024-002", "notes": "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©", "payment_method": "bank_transfer", "status": "pending", "title_ar": "ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ÙƒÙŠÙØ§Øª", "title_en": "AC Maintenance", "vendor": "Ø´Ø±ÙƒØ© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©"}, {"amount": 850, "approved_at": "2024-01-25T15:00:00Z", "approved_by_name": "Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙˆØ¯", "category": "utilities", "created_at": "2024-01-25T11:00:00Z", "created_by_name": "Ø³Ø¹Ø¯ Ø§Ù„Ø£Ø­Ù…Ø¯", "date": "2024-01-25", "description_ar": "ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø¨Ù†Ù‰", "description_en": "Monthly electricity bill for the building", "hijri_date": "1445/07/13", "hijri_month": 7, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440003", "invoice_number": "ELEC-2024-001", "notes": "Ø¯ÙØ¹Øª Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©", "payment_method": "online", "status": "approved", "title_ar": "ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡", "title_en": "Electricity Bill", "vendor": "Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡"}, {"amount": 5000, "category": "activities", "created_at": "2024-03-10T10:00:00Z", "created_by_name": "ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ", "date": "2024-03-15", "description_ar": "ØªÙ†Ø¸ÙŠÙ… Ø¥ÙØ·Ø§Ø± Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†", "description_en": "Organizing group iftar for members in Ramadan", "hijri_date": "1445/09/05", "hijri_month": 9, "hijri_year": 1445, "id": "550e8400-e29b-41d4-a716-446655440004", "invoice_number": "RAM-2024-001", "notes": "Ù…Ø±ÙÙˆØ¶ - ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø£Ù‚Ù„", "payment_method": "cash", "rejection_reason": "ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©", "status": "rejected", "title_ar": "Ù†Ø´Ø§Ø· Ø±Ù…Ø¶Ø§Ù†ÙŠ", "title_en": "Ramadan Activity", "vendor": "Ù…Ø·Ø¹Ù… Ø§Ù„Ø¶ÙŠØ§ÙØ©"}], "metadata": {"limit": 50, "page": 1, "total_pages": 1}, "total_amount": 10550, "total_count": 4}, "message_ar": "ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­", "success": true}

    [0m [90m 87 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 88 |[39m       [90m// Response structure: {expenses: [...], metadata: {...}, total_amount, total_count}[39m
    [31m[1m>[22m[39m[90m 89 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'expenses'[39m)[33m;[39m
     [90m    |[39m                             [31m[1m^[22m[39m
     [90m 90 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'total_amount'[39m)[33m;[39m
     [90m 91 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'total_count'[39m)[33m;[39m
     [90m 92 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'metadata'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:89:29)

  â— Expenses Controller Integration Tests â€º GET /api/expenses â€º should include pagination information

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 145 |[39m
     [90m 146 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 147 |[39m       expect(response[33m.[39mbody[33m.[39mmetadata)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 148 |[39m       expect(response[33m.[39mbody[33m.[39mmetadata)[33m.[39mtoHaveProperty([32m'limit'[39m)[33m;[39m
     [90m 149 |[39m       expect(response[33m.[39mbody[33m.[39mmetadata)[33m.[39mtoHaveProperty([32m'page'[39m)[33m;[39m
     [90m 150 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:147:38)

  â— Expenses Controller Integration Tests â€º POST /api/expenses â€º should deny access to members

    expect(received).toContain(expected) // indexOf

    Expected substring: "Financial Manager"
    Received string:    "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©"

    [0m [90m 181 |[39m
     [90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 183 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Financial Manager'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 184 |[39m     })[33m;[39m
     [90m 185 |[39m
     [90m 186 |[39m     it([32m'should require all required fields'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:183:35)

  â— Expenses Controller Integration Tests â€º POST /api/expenses â€º should require all required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 201

    [0m [90m 194 |[39m         })[33m;[39m
     [90m 195 |[39m
    [31m[1m>[22m[39m[90m 196 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 197 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 198 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m 199 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:196:31)

  â— Expenses Controller Integration Tests â€º POST /api/expenses â€º should auto-approve for financial managers

    expect(received).toBe(expected) // Object.is equality

    Expected: "approved"
    Received: "pending"

    [0m [90m 221 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m201[39m) {
     [90m 222 |[39m         expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 223 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mstatus)[33m.[39mtoBe([32m'approved'[39m)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 224 |[39m         expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'auto-approved'[39m)[33m;[39m
     [90m 225 |[39m       }
     [90m 226 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:223:43)

  â— Expenses Controller Integration Tests â€º POST /api/expenses â€º should generate Hijri dates automatically

    expect(received).toHaveProperty(path)

    Expected path: "hijri_date_string"
    Received path: []

    Received value: {"amount": 200, "category": "general", "created_at": "2025-10-11T07:34:35.088Z", "created_by": "fm-test-id", "date": "2025-10-11", "description": "Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯", "hijri_date": "1445/07/15", "hijri_month": 7, "hijri_year": 1445, "id": 1760168075088, "invoice_number": "INV-1760168075088", "payment_method": "cash", "status": "pending", "vendor": "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}

    [0m [90m 241 |[39m
     [90m 242 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m201[39m) {
    [31m[1m>[22m[39m[90m 243 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'hijri_date_string'[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 244 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'hijri_year'[39m)[33m;[39m
     [90m 245 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'hijri_month'[39m)[33m;[39m
     [90m 246 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'hijri_day'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:243:36)

  â— Expenses Controller Integration Tests â€º GET /api/expenses/statistics â€º should return comprehensive statistics

    expect(received).toHaveProperty(path)

    Expected path: "period"
    Received path: []

    Received value: {"category_breakdown": [{"amount": 5000, "category": "office_supplies", "count": 10}, {"amount": 8000, "category": "maintenance", "count": 5}, {"amount": 12500, "category": "utilities", "count": 8}], "monthly_average": 8500, "monthly_trend": [{"amount": 8500, "month": "Ù…Ø­Ø±Ù…"}, {"amount": 9200, "month": "ØµÙØ±"}, {"amount": 7800, "month": "Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„"}], "payment_method_breakdown": [{"amount": 10000, "count": 12, "method": "cash"}, {"amount": 12000, "count": 8, "method": "bank_transfer"}, {"amount": 3500, "count": 3, "method": "online"}], "total_approved": 18000, "total_expenses": 25500, "total_pending": 7500, "total_rejected": 0}

    [0m [90m 277 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 278 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 279 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'period'[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 280 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'totals'[39m)[33m;[39m
     [90m 281 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'by_status'[39m)[33m;[39m
     [90m 282 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'by_category'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:279:34)

  â— Expenses Controller Integration Tests â€º GET /api/expenses/statistics â€º should support period filtering

    TypeError: Cannot read properties of undefined (reading 'type')

    [0m [90m 292 |[39m
     [90m 293 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 294 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mperiod[33m.[39mtype)[33m.[39mtoBe([32m'month'[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 295 |[39m     })[33m;[39m
     [90m 296 |[39m
     [90m 297 |[39m     it([32m'should support Hijri year filtering'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:294:40)

  â— Expenses Controller Integration Tests â€º GET /api/expenses/statistics â€º should support Hijri year filtering

    TypeError: Cannot read properties of undefined (reading 'hijri_year')

    [0m [90m 303 |[39m
     [90m 304 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 305 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mperiod[33m.[39mhijri_year)[33m.[39mtoBe([35m1446[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 306 |[39m     })[33m;[39m
     [90m 307 |[39m   })[33m;[39m
     [90m 308 |[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/expenses.test.js:305:40)

(node:24772) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mName search error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mName search error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mName search error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError generating statement[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mStatement generation error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError generating statement[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mStatement generation error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
PASS __tests__/integration/controllers/statements.test.js
  Statements Controller Integration Tests
    GET /api/statements/search/phone
      âˆš should require authentication (73 ms)
      âˆš should require phone parameter (119 ms)
      âˆš should require minimum 8 digits (19 ms)
      âˆš should validate phone format (12 ms)
      âˆš should search by Saudi phone number (117 ms)
      âˆš should return statement with financial data (14 ms)
      âˆš should return alert messages (15 ms)
      âˆš should return recent transactions (13 ms)
    GET /api/statements/search/name
      âˆš should require authentication (9 ms)
      âˆš should require name parameter (10 ms)
      âˆš should require minimum 3 characters (12 ms)
      âˆš should search by Arabic name (11 ms)
      âˆš should normalize Arabic text for better search (12 ms)
      âˆš should limit results to 10 members (12 ms)
    GET /api/statements/search/member-id
      âˆš should require authentication (6 ms)
      âˆš should require memberId parameter (9 ms)
      âˆš should search by membership number (10 ms)
    GET /api/statements/generate/:memberId
      âˆš should require authentication (4 ms)
      âˆš should generate statement for member (14 ms)
      âˆš should include comprehensive statement data (11 ms)
    Statement Data Quality
      âˆš should calculate balance correctly (9 ms)
      âˆš should set appropriate alert levels (13 ms)
      âˆš should calculate percentage complete correctly (12 ms)
      âˆš should include transaction statistics (10 ms)

PASS __tests__/integration/routes/payments.test.js
  Payment Integration Tests
    POST /api/payments (Create Payment)
      âˆš should reject payment creation without authentication (73 ms)
      âˆš should reject payment creation by member (requires financial role) (11 ms)
      âˆš should accept payment creation by financial manager (104 ms)
      âˆš should validate required payment fields (10 ms)
      âˆš should validate payment amount is positive (10 ms)
      âˆš should validate payment category (10 ms)
    GET /api/payments/:id (Get Payment by ID)
      âˆš should reject without authentication (5 ms)
      âˆš should allow financial manager to get payment (44 ms)
      âˆš should allow member to get their own payment (9 ms)
      âˆš should return 404 for non-existent payment (13 ms)
    PUT /api/payments/:id/status (Update Payment Status)
      âˆš should reject without authentication (6 ms)
      âˆš should reject status update by member (6 ms)
      âˆš should allow financial manager to update status (6 ms)
      âˆš should validate status values (8 ms)
      âˆš should accept valid status values (37 ms)
    POST /api/payments/:id/process (Process Payment)
      âˆš should reject without authentication (5 ms)
      âˆš should reject processing by member (5 ms)
      âˆš should allow financial manager to process payment (6 ms)
      âˆš should return proper error for already processed payment (14 ms)
    Payment Flow Integration
      âˆš should handle complete payment lifecycle (11 ms)
    Error Handling
      âˆš should return proper error structure (9 ms)
      âˆš should handle malformed JSON gracefully (9 ms)
      âˆš should validate payment amounts (47 ms)
    Role-Based Access Control
      âˆš should enforce role requirements for create (7 ms)
      âˆš should enforce role requirements for status update (6 ms)
      âˆš should enforce role requirements for processing (5 ms)

2025-10-11 10:34:35 [[31merror[39m]: [31mError updating member[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError updating member[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mSupabase create member error[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mCreate member failed[39m
2025-10-11 10:34:35 [[31merror[39m]: [31mError logging access[39m
PASS __tests__/integration/routes/auth.test.js
  Auth Integration Tests
    POST /api/auth/login (Admin Login)
      âˆš should reject login without credentials (67 ms)
      âˆš should reject login with only email (12 ms)
      âˆš should reject login with only password (9 ms)
      âˆš should handle login attempt with valid format but non-existent user (272 ms)
      âˆš should accept phone-based admin login format (9 ms)
      âˆš should validate email format in identifier (8 ms)
    POST /api/auth/member-login (Member Login)
      âˆš should reject member login without credentials (5 ms)
      âˆš should reject member login with only phone (6 ms)
      âˆš should reject member login with only password (10 ms)
      âˆš should authenticate test member with valid credentials (11 ms)
      âˆš should authenticate test member with test password (11 ms)
      âˆš should reject test member with wrong password (10 ms)
      âˆš should return proper member data structure (11 ms)
    POST /api/auth/mobile-login (Mobile Login Alias)
      âˆš should work identically to member-login (18 ms)
      âˆš should authenticate via mobile-login endpoint (13 ms)
    POST /api/auth/verify (JWT Verification)
      âˆš should reject verification without token (4 ms)
      âˆš should reject verification with invalid token (4 ms)
      âˆš should verify valid token (6 ms)
      âˆš should return user data in verification response (7 ms)
      âˆš should include newToken if token is expiring soon (6 ms)
    POST /api/auth/refresh (Token Refresh)
      âˆš should reject refresh without token (5 ms)
      âˆš should reject refresh with invalid token (5 ms)
      âˆš should refresh valid token (7 ms)
      âˆš should return user data with refreshed token (6 ms)
      âˆš refreshed token should preserve user data (8 ms)
    POST /api/auth/change-password (Password Change)
      âˆš should reject password change without token (5 ms)
      âˆš should reject password change with invalid token (4 ms)
      âˆš should reject password change without new password (6 ms)
      âˆš should accept password change for test member (12 ms)
      âˆš should return Arabic success message (7 ms)
    Phone Number Normalization
      âˆš should accept phone with spaces (6 ms)
      âˆš should accept phone with dashes (8 ms)
      âˆš should accept international format (7 ms)
    Error Handling
      âˆš should return proper error structure (3 ms)
      âˆš should handle malformed JSON gracefully (7 ms)
      âˆš should handle missing content-type header (3 ms)

FAIL __tests__/integration/controllers/members.test.js
  Members Controller Integration Tests
    GET /api/members
      Ã— should require authentication (115 ms)
      Ã— should return paginated members list for admin (14 ms)
      Ã— should filter by membership status (14 ms)
      Ã— should filter by profile completion (11 ms)
      Ã— should support search by name or phone (11 ms)
      Ã— should respect pagination limits (11 ms)
    GET /api/members/:id
      âˆš should require authentication (6 ms)
      âˆš should return member by ID for admin (13 ms)
      âˆš should return 404 for non-existent member (26 ms)
    GET /api/members/statistics
      âˆš should require authentication (6 ms)
      Ã— should return comprehensive member statistics (15 ms)
      Ã— should have numeric statistics (13 ms)
    POST /api/members
      âˆš should require authentication (17 ms)
      âˆš should validate required fields (6 ms)
      âˆš should reject duplicate phone numbers (12 ms)
    GET /api/members/profile (Mobile)
      âˆš should require authentication (3 ms)
      âˆš should return member own profile (6 ms)
      âˆš should not include sensitive fields in profile (6 ms)

  â— Members Controller Integration Tests â€º GET /api/members â€º should require authentication

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [401, 403]

    [0m [90m 49 |[39m         [33m.[39m[36mget[39m([32m'/api/members'[39m)[33m;[39m
     [90m 50 |[39m
    [31m[1m>[22m[39m[90m 51 |[39m       expect([[35m401[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 52 |[39m     })[33m;[39m
     [90m 53 |[39m
     [90m 54 |[39m     it([32m'should return paginated members list for admin'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:51:26)

  â— Members Controller Integration Tests â€º GET /api/members â€º should return paginated members list for admin

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 59 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 60 |[39m
    [31m[1m>[22m[39m[90m 61 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 62 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 63 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBeDefined()[33m;[39m
     [90m 64 |[39m       expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39mdata))[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:61:31)

  â— Members Controller Integration Tests â€º GET /api/members â€º should filter by membership status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 77 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 78 |[39m
    [31m[1m>[22m[39m[90m 79 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 80 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 81 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:79:31)

  â— Members Controller Integration Tests â€º GET /api/members â€º should filter by profile completion

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 89 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 90 |[39m
    [31m[1m>[22m[39m[90m 91 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 92 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 93 |[39m     })[33m;[39m
     [90m 94 |[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:91:31)

  â— Members Controller Integration Tests â€º GET /api/members â€º should support search by name or phone

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 100 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 101 |[39m
    [31m[1m>[22m[39m[90m 102 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 103 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 104 |[39m     })[33m;[39m
     [90m 105 |[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:102:31)

  â— Members Controller Integration Tests â€º GET /api/members â€º should respect pagination limits

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 111 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 112 |[39m
    [31m[1m>[22m[39m[90m 113 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 114 |[39m       expect(response[33m.[39mbody[33m.[39mpagination[33m.[39mlimit)[33m.[39mtoBeLessThanOrEqual([35m10[39m)[33m;[39m
     [90m 115 |[39m     })[33m;[39m
     [90m 116 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:113:31)

  â— Members Controller Integration Tests â€º GET /api/members/statistics â€º should return comprehensive member statistics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 172 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 173 |[39m
    [31m[1m>[22m[39m[90m 174 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 175 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 176 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBeDefined()[33m;[39m
     [90m 177 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'total_members'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:174:31)

  â— Members Controller Integration Tests â€º GET /api/members/statistics â€º should have numeric statistics

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 190 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 193 |[39m       expect([36mtypeof[39m response[33m.[39mbody[33m.[39mdata[33m.[39mtotal_members)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 194 |[39m       expect([36mtypeof[39m response[33m.[39mbody[33m.[39mdata[33m.[39mactive_members)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 195 |[39m       expect([36mtypeof[39m response[33m.[39mbody[33m.[39mdata[33m.[39mcompleted_profiles)[33m.[39mtoBe([32m'number'[39m)[33m;[39m[0m

      at Object.<anonymous> (__tests__/integration/controllers/members.test.js:192:31)

Test Suites: 2 failed, 6 passed, 8 total
Tests:       18 failed, 200 passed, 218 total
Snapshots:   0 total
Time:        2.49 s, estimated 3 s
Ran all test suites.
